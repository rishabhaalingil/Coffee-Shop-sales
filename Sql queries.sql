SELECT * FROM coffee_shop.coffee_shop_sales;

-- Total Sales ---------------------------------------------------------------------------------------------------
SELECT CONCAT(ROUND(SUM(unit_price*transaction_quantity))/1000,"K") AS total_sales
FROM coffee_shop_sales
WHERE 
MONTH(transaction_date)=3; -- March month


-- Total Sales Month On Month -----------------------------------------------------------------------------------------
SELECT MONTH(transaction_date) AS month,-- Number of month
ROUND(SUM(unit_price*transaction_quantity)) as total_sales,-- Total sales column
(SUM(unit_price*transaction_quantity)-LAG(SUM(unit_price*transaction_quantity),1) -- Month Sales Difference
OVER(ORDER BY MONTH(transaction_date)))/NULLIF(LAG(SUM(unit_price*transaction_quantity),1) -- Division By PM Sales
OVER (ORDER BY MONTH(transaction_date)),0)*100 AS mom_increase_precentage
FROM coffee_shop_sales
WHERE MONTH(transaction_date) IN (4,5) -- for months of april and may
GROUP BY
MONTH(transaction_date)
ORDER BY 
MONTH(transaction_date);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              

-- Total Orders---------------------------------------------------------------------------------------------------
SELECT COUNT(transaction_id) AS total_sales
FROM coffee_shop_sales
WHERE 
MONTH(transaction_date)=5; -- May month

-- Total Orders Month on Month----------------------------------------------------------------------------------------
SELECT MONTH(transaction_date) AS month,
ROUND(COUNT(transaction_id)) AS total_orders,
(COUNT(transaction_id)-LAG(COUNT(transaction_id),1)over(order by month(transaction_date)))/LAG(COUNT(transaction_date),1)
over(order by month(transaction_date))*100 AS mom_increase_percentage
FROM coffee_shop_sales
where month(transaction_date) IN (4,5) -- FOR APRIL AND MAY
GROUP BY 
month(transaction_date)
order by month(transaction_date);

-- Total quantity sold analysis----------------------------------------------------------------------------------------
SELECT sum(transaction_quantity) as Total_quantity_sold
from coffee_shop_sales
where month(transaction_date)=5; -- May month

-- Total month on month quantity sales increase----------------------------------------------------------------------------------
SELECT month(transaction_date) as month,
round(sum(transaction_quantity)) as total_quantity_sold,
(sum(transaction_quantity)-lag(sum(transaction_quantity),1)over(order by month(transaction_date)))/nullif(lag(sum(transaction_quantity),1)
over(order by month(transaction_date)),0)*100 as mom_increase_percentage
from coffee_shop_sales
where month(transaction_date) in (4,5) -- for april and may
group by month(transaction_date)
order by month(transaction_date);

-- SQL QUERIES FOR CALENDER HEAT MAP-------------------------------------------------------------------------------------------
SELECT 
	CONCAT(ROUND(SUM(unit_price*transaction_quantity)/1000,1),"K") as total_sales,
    CONCAT(ROUND(SUM(transaction_quantity)/1000,1),"K") as total_quantity,
    concat(ROUND(COUNT(transaction_id)/1000,1),"k") as total_orders
from coffee_shop_sales
where transaction_date="2023-05-27";

-- SQL QUERIES FOR SALES BY WEEKEND AND WEEKDAYS------------------------------------------------------------------------------
SELECT 
	CASE WHEN DAYOFWEEK(transaction_date) IN (1,7) THEN "WEEKENDS"
    ELSE "WEEKDAYS"
    END AS day_type,
    CONCAT(ROUND(sum(unit_price*transaction_quantity)/1000,1),"k") as total_sales
FROM coffee_shop_sales
where month(transaction_date)=2
group by 	
	CASE WHEN DAYOFWEEK(transaction_date) IN (1,7) THEN "WEEKENDS"
    ELSE "WEEKDAYS"
    END ;
    
select concat(round(sum(unit_price*transaction_quantity)/1000,1),"k") as total_sales
from coffee_shop_sales
where month(transaction_date)=2;

-- SQL QUERIES FOR SALES BY STORE LOCATION------------------------------------------------------------------------------------
SELECT
	store_location,
    concat(round(sum(unit_price*transaction_quantity)/1000,2),"k") as total_sales
FROM coffee_shop_sales
where month(transaction_date)=6  -- May month
group by store_location
order by total_sales desc;

-- DAILY SALES ANALYSIS WITH AVERAGE LINE--------------------------------------------------------------------------------------

-- SELECT 
-- 	AVG(unit_price*transaction_quantity) as average_sales
-- FROM coffee_shop_sales
-- where month(transaction_date)=5;
-- The above query is wrong as it calculates average of total number of transactions(33527) made rather than the total
--  number of days in the month(30).

SELECT CONCAT(ROUND(AVG(total_sales)/1000,1),"K") as avg_sales
FROM 
	(SELECT SUM(unit_price*transaction_quantity) as total_sales
    FROM coffee_shop_sales
    WHERE MONTH(transaction_date)=5
    GROUP BY transaction_date
    )AS Internal_query;
    
-- Sales On A Daily Basis------------------------------------------------------------------------------------------------
SELECT 
	DAY(transaction_date) as day_of_month,
    SUM(unit_price*transaction_quantity) AS total_sales
    FROM coffee_shop_sales
	WHERE MONTH(transaction_date)=5
    GROUP BY day_of_month
    ORDER BY day_of_month;
-- Sales and their status compared to the total sales-----------------------------------------------------------------------
SELECT 
	day_of_month,
    CASE
		WHEN total_sales > avg_sales THEN 'Above Average'
        WHEN total_sales < avg_sales THEN 'Below Average'
        ELSE "Equal to average"
        END AS sale_status,
        total_sales
FROM(
		SELECT 
			DAY(transaction_date) AS day_of_month,
            SUM(unit_price*transaction_quantity) AS total_sales,
            AVG(SUM(unit_price*transaction_quantity)) OVER() AS avg_sales
		FROM
			coffee_shop_sales
		WHERE 
			MONTH(transaction_date)=5 -- Filter for may
		GROUP BY
			day_of_month) AS sales_data
		ORDER BY
			day_of_month;
-- SUM(unit_price * transaction_quantity): This is aggregated for each day, resulting in total_sales for each day of May.
-- AVG(...): This takes the average of those daily total sales. However, there's a key point here: the SUM(...) inside AVG() is not calculated until after the grouping is done, which is handled by the OVER() clause.
-- OVER(): This indicates that the average should be calculated across the entire result set produced by the inner query, without any partitioning (i.e., it considers all days of May together).


-- Sales Analysis By Product Category----------------------------------------------------------------------------------------
SELECT 
	product_category,
	SUM(unit_price*transaction_quantity) as total_sales
   
FROM coffee_shop_sales
WHERE month(transaction_date)=5
group by product_category
order by total_sales desc;

-- Sales Analysis By Product Type(Top 10) -----------------------------------------------------------------------------------------
SELECT 
	product_type,
	SUM(unit_price*transaction_quantity) as total_sales
   
FROM coffee_shop_sales
WHERE month(transaction_date)=5
group by product_type
order by total_sales desc
limit 10;

-- Sales by day and hour of the week-------------------------------------------------------------------------------------------
SELECT
	sum(unit_price*transaction_quantity) as total_sales,
    count(*) as total_orders,
    sum(transaction_quantity) as total_quantities
FROM 
	coffee_shop_sales
WHERE month(transaction_date)=5
AND DAYOFWEEK(transaction_date)=1 -- DAY OF WEEK
AND HOUR(transaction_time)=14;-- HOUR OF THE DAY

-- Sales By Hours of the day for a month---------------------------------------------------------------------------------------
SELECT 
	HOUR(transaction_time) AS transaction_time,
    SUM(unit_price*transaction_quantity) AS total_sales
FROM coffee_shop_sales
WHERE  MONTH(transaction_date)=5
GROUP BY HOUR(transaction_time)
ORDER BY transaction_time;

-- Sales By Days of the week-------------------------------------------------------------------------------------------------
SELECT 
	CASE
		WHEN DAYOFWEEK(transaction_date)=2 THEN "MONDAY"
        WHEN DAYOFWEEK(transaction_date)=3 THEN "TUESDAY"
        WHEN DAYOFWEEK(transaction_date)=4 THEN "WEDNESDAY"
        WHEN DAYOFWEEK(transaction_date)=5 THEN "THURSDAY"
        WHEN DAYOFWEEK(transaction_date)=6 THEN "FRIDAY"
        WHEN DAYOFWEEK(transaction_date)=2 THEN "SATURDAY"
        ELSE "SUNDAY"
        END AS day_of_week,
        round(sum(unit_price*transaction_quantity),2) as total_sales
FROM coffee_shop_sales
WHERE MONTH(transaction_date)=5 -- May month
GROUP BY day_of_week;
        